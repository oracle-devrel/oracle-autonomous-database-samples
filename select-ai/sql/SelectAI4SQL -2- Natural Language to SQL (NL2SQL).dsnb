[{"layout":"zeppelin","isRunnable":true,"template":null,"templateConfig":null,"isEditable":true,"name":"SelectAI4SQL -2- Natural Language to SQL (NL2SQL)","description":null,"type":"medium","paragraphs":[{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md"," "],"enabled":true,"result":{"startTime":1760115763531,"interpreter":"md.medium","endTime":1760115764099,"results":[],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":true,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","# Using Select AI for Natural Language to SQL (NL2SQL) Generation","","One of the features of Select AI enables you to ask questions of your database data using natural language. ","Select AI augments your user-provided prompt with metadata from tables and views in your database schema before sending it to LLMs. ","The generated SQL query is then processed according the 'action' specified. ","","Select AI provides multiple **actions**. These are related to NL2SQL: ","","* `showsql` - generate and return the SQL query","* `runsql` (default) - generate and run the SQL query returning the query result","* `narrate` - generate natural language text from data returned from the NL2SQL query or RAG, depending on the AI profile settings","* `explainsql` - return an explanation of generated SQL query","",">Note that the full Select AI functionality is available in Oracle Autonomous Database 23ai. NL2SQL is available with Oracle Database 23.7+ instances and Autonomous Database 19c instances. ","","---","","Copyright (c) 2025 Oracle Corporation  ","###### [The Universal Permissive License (UPL), Version 1.0](https://oss.oracle.com/licenses/upl/)"],"enabled":true,"result":{"startTime":1760115764477,"interpreter":"md.medium","endTime":1760115764917,"results":[{"message":"<h1 id=\"using-select-ai-for-natural-language-to-sql-nl2sql-generation\">Using Select AI for Natural Language to SQL (NL2SQL) Generation<\/h1>\n<p>One of the features of Select AI enables you to ask questions of your database data using natural language.\nSelect AI augments your user-provided prompt with metadata from tables and views in your database schema before sending it to LLMs.\nThe generated SQL query is then processed according the 'action' specified.<\/p>\n<p>Select AI provides multiple <strong>actions<\/strong>. These are related to NL2SQL:<\/p>\n<ul>\n<li><code>showsql<\/code> - generate and return the SQL query<\/li>\n<li><code>runsql<\/code> (default) - generate and run the SQL query returning the query result<\/li>\n<li><code>narrate<\/code> - generate natural language text from data returned from the NL2SQL query or RAG, depending on the AI profile settings<\/li>\n<li><code>explainsql<\/code> - return an explanation of generated SQL query<\/li>\n<\/ul>\n<blockquote>\n<p>Note that the full Select AI functionality is available in Oracle Autonomous Database 23ai. NL2SQL is available with Oracle Database 23.7+ instances and Autonomous Database 19c instances.<\/p>\n<\/blockquote>\n<hr />\n<p>Copyright (c) 2025 Oracle Corporation<\/p>\n<h6 id=\"the-universal-permissive-license-upl-version-10\"><a href=\"https://oss.oracle.com/licenses/upl/\">The Universal Permissive License (UPL), Version 1.0<\/a><\/h6>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"For more information...","message":["%md","","* <a href=\"https://docs.oracle.com/en/cloud/paas/autonomous-database/serverless/adbsb/select-ai-about.html\" target=\"_blank\" rel=\"noopener noreferrer\"> Select AI documentation<\/a>","* <a href=\"https://docs.oracle.com/en/cloud/paas/autonomous-database/serverless/adbsb/dbms-cloud-ai-package.html\" target=\"_blank\" rel=\"noopener noreferrer\"> DBMS_CLOUD_AI documentation<\/a>"],"enabled":true,"result":{"startTime":1760115765293,"interpreter":"md.medium","endTime":1760115765634,"results":[{"message":"<ul>\n<li><a href=\"https://docs.oracle.com/en/cloud/paas/autonomous-database/serverless/adbsb/select-ai-about.html\" target=\"_blank\" rel=\"noopener noreferrer\"> Select AI documentation<\/a><\/li>\n<li><a href=\"https://docs.oracle.com/en/cloud/paas/autonomous-database/serverless/adbsb/dbms-cloud-ai-package.html\" target=\"_blank\" rel=\"noopener noreferrer\"> DBMS_CLOUD_AI documentation<\/a><\/li>\n<\/ul>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":0,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","## Prerequisites","","Before proceeding, you must complete steps in the **Select AI Prerequisites and Setup** notebook:","","* ADMIN: grants and network access","* Select AI user: OCI_GENAI profile definition","","These steps are required for the NL2SQL commands in this notebook to run correctly."],"enabled":true,"result":{"startTime":1760115766019,"interpreter":"md.medium","endTime":1760115766370,"results":[{"message":"<h2 id=\"prerequisites\">Prerequisites<\/h2>\n<p>Before proceeding, you must complete steps in the <strong>Select AI Prerequisites and Setup<\/strong> notebook:<\/p>\n<ul>\n<li>ADMIN: grants and network access<\/li>\n<li>Select AI user: OCI_GENAI profile definition<\/li>\n<\/ul>\n<p>These steps are required for the NL2SQL commands in this notebook to run correctly.<\/p>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Set the OCI_GENAI profile for the current session","message":["%script","","EXEC DBMS_CLOUD_AI.SET_PROFILE(profile_name => 'OCI_GENAI')"],"enabled":true,"result":{"startTime":1760115766753,"interpreter":"script.medium","endTime":1760115769930,"results":[{"message":"\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","### Working with NL2SQL Actions","","In the following examples, you'll see how to use each Select AI NL2SQL action.  ","","Use `showsql` to display SQL generated from natural language without running it, followed by `runsql` to both generate and run the SQL query. Use ","`showprompt` to reveal the augmented prompt that includes your schema metadata. ","","You'll learn how to build on previous queries by asking follow-up questions leveraging the original conversation capability, ","followed by the converation management API for greater control over conversations.  ","Then, examine a more complex example that interprets business terms like \"baby boomer.\" ","","Then, use `narrate` to get natural language text from the structured results, `explainsql` to understand the generated SQL, and the `GENERATE` function for programmatic access."],"enabled":true,"result":{"startTime":1760115770314,"interpreter":"md.medium","endTime":1760115779250,"results":[{"message":"<h3 id=\"working-with-nl2sql-actions\">Working with NL2SQL Actions<\/h3>\n<p>In the following examples, you'll see how to use each Select AI NL2SQL action.<\/p>\n<p>Use <code>showsql<\/code> to display SQL generated from natural language without running it, followed by <code>runsql<\/code> to both generate and run the SQL query. Use\n<code>showprompt<\/code> to reveal the augmented prompt that includes your schema metadata.<\/p>\n<p>You'll learn how to build on previous queries by asking follow-up questions leveraging the original conversation capability,\nfollowed by the converation management API for greater control over conversations.<br />\nThen, examine a more complex example that interprets business terms like &quot;baby boomer.&quot;<\/p>\n<p>Then, use <code>narrate<\/code> to get natural language text from the structured results, <code>explainsql<\/code> to understand the generated SQL, and the <code>GENERATE<\/code> function for programmatic access.<\/p>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Show SQL for \"how many customers do I have\"","message":["%script","","SELECT AI showsql how many customers do I have"],"enabled":true,"result":{"startTime":1760115779622,"interpreter":"script.medium","endTime":1760115796412,"results":[{"message":"\nRESPONSE                                          \nSELECT COUNT(c.\"CUST_ID\") AS \"Customer Count\" \nFROM \"SH\".\"CUSTOMERS\" c \nWHERE c.\"CUST_VALID\" = 'Y'    \n\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"Run SQL query for \"how many customers do I have\" ","message":["%sql","","SELECT AI how many customers do I have","","--Alternate specification with 'runsql'","--SELECT AI runsql how many customers do I have"],"enabled":true,"result":{"startTime":1760115796858,"interpreter":"sql.medium","endTime":1760115798927,"results":[{"message":"Customer Count\n0\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"Show prompt for \"how many customers do I have\"","message":["%sql","","SELECT AI showprompt how many customers do I have"],"enabled":true,"result":{"startTime":1760115799297,"interpreter":"sql.medium","endTime":1760115800244,"results":[{"message":"RESPONSE\n[   {     \"role\" : \"SYSTEM\",     \"content\" :     [       {         \"type\" : \"TEXT\",         \"text\" : \"### Oracle SQL tables with their properties:\"       }     ]   },   {     \"role\" : \"SYSTEM\",     \"content\" :     [       {         \"type\" : \"TEXT\",         \"text\" : \"--'dimension table' # CREATE TABLE \\\"SH\\\".\\\"CUSTOMERS\\\" (\\\"CUST_FIRST_NAME\\\" VARCHAR2(20) 'first name of the customer' , \\\"CUST_CREDIT_LIMIT\\\" NUMBER 'customer credit limit' , \\\"CUST_INCOME_LEVEL\\\" VARCHAR2(30) 'customer income level' , \\\"CUST_MAIN_PHONE_NUMBER\\\" VARCHAR2(25) 'customer main phone number' , \\\"CUST_YEAR_OF_BIRTH\\\" NUMBER(4,0) 'customer year of birth' , \\\"CUST_MARITAL_STATUS\\\" VARCHAR2(20) 'customer marital status; low cardinality attribute' , \\\"CUST_EFF_TO\\\" DATE , \\\"CUST_LAST_NAME\\\" VARCHAR2(40) 'last name of the customer' , \\\"CUST_SRC_ID\\\" NUMBER , \\\"CUST_CITY\\\" VARCHAR2(30) 'city where the customer lives' , \\\"CUST_ID\\\" NUMBER 'primary key' , \\\"CUST_EFF_FROM\\\" DATE , \\\"CUST_TOTAL_ID\\\" NUMBER , \\\"CUST_STREET_ADDRESS\\\" VARCHAR2(40) 'customer street address' , \\\"CUST_TOTAL\\\" VARCHAR2(14) , \\\"CUST_STATE_PROVINCE_ID\\\" NUMBER , \\\"CUST_CITY_ID\\\" NUMBER , \\\"CUST_GENDER\\\" CHAR(1) 'gender; low cardinality attribute' , \\\"CUST_VALID\\\" VARCHAR2(1) , \\\"CUST_EMAIL\\\" VARCHAR2(50) 'customer email id' , \\\"COUNTRY_ID\\\" NUMBER 'foreign key to the countries table (snowflake)' , \\\"CUST_POSTAL_CODE\\\" VARCHAR2(10) 'postal code of the customer' , \\\"CUST_STATE_PROVINCE\\\" VARCHAR2(40) 'customer geography: state or province')\"       }     ]   },   {     \"role\" : \"SYSTEM\",     \"content\" :     [       {         \"type\" : \"TEXT\",         \"text\" : \"--'facts table, without a primary key; all rows are uniquely identified by the combination of all foreign keys' # CREATE TABLE \\\"SH\\\".\\\"SALES\\\" (\\\"CHANNEL_ID\\\" NUMBER 'FK to the channels dimension table' , \\\"QUANTITY_SOLD\\\" NUMBER(10,2) 'product quantity sold with the transaction' , \\\"AMOUNT_SOLD\\\" NUMBER(10,2) 'invoiced amount to the customer' , \\\"CUST_ID\\\" NUMBER 'FK to the customers dimension table' , \\\"PROD_ID\\\" NUMBER 'FK to the products dimension table' , \\\"TIME_ID\\\" DATE 'FK to the times dimension table' , \\\"PROMO_ID\\\" NUMBER 'promotion identifier, without FK constraint (intentionally) to show outer join optimization')\"       }     ]   },   {     \"role\" : \"SYSTEM\",     \"content\" :     [       {         \"type\" : \"TEXT\",         \"text\" : \"--'dimension table' # CREATE TABLE \\\"SH\\\".\\\"PRODUCTS\\\" (\\\"PROD_TOTAL\\\" VARCHAR2(13) , \\\"PROD_UNIT_OF_MEASURE\\\" VARCHAR2(20) 'product unit of measure' , \\\"PROD_TOTAL_ID\\\" NUMBER , \\\"PROD_CATEGORY\\\" VARCHAR2(50) 'product category' , \\\"PROD_SRC_ID\\\" NUMBER , \\\"PROD_WEIGHT_CLASS\\\" NUMBER(3,0) 'product weight class' , \\\"PROD_MIN_PRICE\\\" NUMBER(8,2) 'product minimum price' , \\\"PROD_EFF_FROM\\\" DATE , \\\"PROD_VALID\\\" VARCHAR2(1) , \\\"SUPPLIER_ID\\\" NUMBER(6,0) 'this column' , \\\"PROD_CATEGORY_DESC\\\" VARCHAR2(2000) 'product category description' , \\\"PROD_NAME\\\" VARCHAR2(50) 'product name' , \\\"PROD_STATUS\\\" VARCHAR2(20) 'product status' , \\\"PROD_PACK_SIZE\\\" VARCHAR2(30) 'product package size' , \\\"PROD_SUBCATEGORY_ID\\\" NUMBER , \\\"PROD_ID\\\" NUMBER(6,0) 'primary key' , \\\"PROD_SUBCATEGORY\\\" VARCHAR2(50) 'product subcategory' , \\\"PROD_DESC\\\" VARCHAR2(4000) 'product description' , \\\"PROD_LIST_PRICE\\\" NUMBER(8,2) 'product list price' , \\\"PROD_CATEGORY_ID\\\" NUMBER , \\\"PROD_SUBCATEGORY_DESC\\\" VARCHAR2(2000) 'product subcategory description' , \\\"PROD_EFF_TO\\\" DATE)\"       }     ]   },   {     \"role\" : \"SYSTEM\",     \"content\" :     [       {         \"type\" : \"TEXT\",         \"text\" : \"--'country dimension table (snowflake)' # CREATE TABLE \\\"SH\\\".\\\"COUNTRIES\\\" (\\\"COUNTRY_REGION\\\" VARCHAR2(20) 'e.g. Europe, Asia' , \\\"COUNTRY_NAME\\\" VARCHAR2(40) 'country name' , \\\"COUNTRY_TOTAL_ID\\\" NUMBER , \\\"COUNTRY_NAME_HIST\\\" VARCHAR2(40) , \\\"COUNTRY_ISO_CODE\\\" CHAR(2) , \\\"COUNTRY_TOTAL\\\" VARCHAR2(11) , \\\"COUNTRY_ID\\\" NUMBER 'primary key' , \\\"COUNTRY_REGION_ID\\\" NUMBER , \\\"COUNTRY_SUBREGION_ID\\\" NUMBER , \\\"COUNTRY_SUBREGION\\\" VARCHAR2(30) 'e.g. Western Europe, to allow hierarchies')\"       }     ]   },   {     \"role\" : \"USER\",     \"content\" :     [       {         \"type\" : \"TEXT\",         \"text\" : \"\\n\\nGiven an input Question, create a syntactically correct Oracle SQL query to run. Pretty print the SQL query. \\n - Pay attention to using only the column names that you can see in the schema description.\\n - Be careful to not query for columns that do not exist. Also, pay attention to which column is in which table.\\n - Please double check that the SQL query you generate is valid for Oracle Database.\\n - Consider table name, schema name and column name to be case sensitive and enclose in double quotes.  - Only use the tables listed below. \\n - If the table definition includes the table owner, you should include both the owner name and user-qualified table name in the Oracle SQL. - DO NOT keep empty lines in the middle of the Oracle SQL.\\n - DO NOT write anything else except the Oracle SQL.\\n - Always use table alias and easy to read column aliases. \\n\\nFor string comparisons in WHERE clause, CAREFULLY check if any string in the question is in DOUBLE QUOTES, and follow the rules: \\n - If a string is in DOUBLE QUOTES, use case SENSITIVE comparisons with NO UPPER() function.\\n - If a string is not in DOUBLE QUOTES, use case INSENSITIVE comparisons by using UPPER() function around both operands of the string comparison.\\nNote: These rules apply strictly to string comparisons in the WHERE clause and do not affect column names, table names, or other query components.\\n\\nQuestion: how many customers do I have\"       }     ]   } ]\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":null,"title":"'showprompt' result in formatted JSON output","message":["PROMPT","[","    {","        \"role\": \"SYSTEM\",","        \"content\": [","            {","                \"type\": \"TEXT\",","                \"text\": \"### Oracle SQL tables with their properties:\"","            }","        ]","    },","    {","        \"role\": \"SYSTEM\",","        \"content\": [","            {","                \"type\": \"TEXT\",","                \"text\": \"# CREATE TABLE SH.CUSTOMERS (CUST_ID NUMBER 'primary key', CUST_VALID VARCHAR2(1), CUST_EFF_TO DATE, CUST_EFF_FROM DATE, CUST_SRC_ID NUMBER, CUST_TOTAL_ID NUMBER, CUST_TOTAL VARCHAR2(14), CUST_EMAIL VARCHAR2(50) 'customer email id', CUST_CREDIT_LIMIT NUMBER 'customer credit limit', CUST_INCOME_LEVEL VARCHAR2(30) 'customer income level', CUST_MAIN_PHONE_NUMBER VARCHAR2(25) 'customer main phone number', COUNTRY_ID NUMBER 'foreign key to the countries table (snowflake)', CUST_STATE_PROVINCE_ID NUMBER, CUST_STATE_PROVINCE VARCHAR2(40) 'customer geography: state or province', CUST_CITY_ID NUMBER, CUST_CITY VARCHAR2(30) 'city where the customer lives', CUST_POSTAL_CODE VARCHAR2(10) 'postal code of the customer', CUST_STREET_ADDRESS VARCHAR2(40) 'customer street address', CUST_MARITAL_STATUS VARCHAR2(20) 'customer marital status; low cardinality attribute', CUST_YEAR_OF_BIRTH NUMBER(4,0) 'customer year of birth', CUST_GENDER CHAR(1) 'gender; low cardinality attribute', CUST_LAST_NAME VARCHAR2(40) 'last name of the customer', CUST_FIRST_NAME VARCHAR2(20) 'first name of the customer')\"","            }","        ]","    },","    {","        \"role\": \"SYSTEM\",","        \"content\": [","            {","                \"type\": \"TEXT\",","                \"text\": \"# CREATE TABLE SH.SALES (PROD_ID NUMBER 'FK to the products dimension table', AMOUNT_SOLD NUMBER(10,2) 'invoiced amount to the customer', QUANTITY_SOLD NUMBER(10,2) 'product quantity sold with the transaction', PROMO_ID NUMBER 'promotion identifier, without FK constraint (intentionally) to show outer join optimization', CHANNEL_ID NUMBER 'FK to the channels dimension table', TIME_ID DATE 'FK to the times dimension table', CUST_ID NUMBER 'FK to the customers dimension table')\"","            }","        ]","    },","    {","        \"role\": \"SYSTEM\",","        \"content\": [","            {","                \"type\": \"TEXT\",","                \"text\": \"# CREATE TABLE SH.PRODUCTS (PROD_ID NUMBER(6,0) 'primary key', PROD_VALID VARCHAR2(1), PROD_EFF_TO DATE, PROD_EFF_FROM DATE, PROD_SRC_ID NUMBER, PROD_TOTAL_ID NUMBER, PROD_TOTAL VARCHAR2(13), PROD_MIN_PRICE NUMBER(8,2) 'product minimum price', PROD_LIST_PRICE NUMBER(8,2) 'product list price', PROD_STATUS VARCHAR2(20) 'product status', SUPPLIER_ID NUMBER(6,0) 'this column', PROD_PACK_SIZE VARCHAR2(30) 'product package size', PROD_UNIT_OF_MEASURE VARCHAR2(20) 'product unit of measure', PROD_WEIGHT_CLASS NUMBER(3,0) 'product weight class', PROD_CATEGORY_DESC VARCHAR2(2000) 'product category description', PROD_CATEGORY_ID NUMBER, PROD_CATEGORY VARCHAR2(50) 'product category', PROD_SUBCATEGORY_DESC VARCHAR2(2000) 'product subcategory description', PROD_SUBCATEGORY_ID NUMBER, PROD_SUBCATEGORY VARCHAR2(50) 'product subcategory', PROD_DESC VARCHAR2(4000) 'product description', PROD_NAME VARCHAR2(50) 'product name')\"","            }","        ]","    },","    {","        \"role\": \"SYSTEM\",","        \"content\": [","            {","                \"type\": \"TEXT\",","                \"text\": \"# CREATE TABLE SH.COUNTRIES (COUNTRY_ID NUMBER 'primary key', COUNTRY_NAME_HIST VARCHAR2(40), COUNTRY_TOTAL_ID NUMBER, COUNTRY_TOTAL VARCHAR2(11), COUNTRY_REGION_ID NUMBER, COUNTRY_REGION VARCHAR2(20) 'e.g. Europe, Asia', COUNTRY_SUBREGION_ID NUMBER, COUNTRY_SUBREGION VARCHAR2(30) 'e.g. Western Europe, to allow hierarchies', COUNTRY_NAME VARCHAR2(40) 'country name', COUNTRY_ISO_CODE CHAR(2))\"","            }","        ]","    },","    {","        \"role\": \"USER\",","        \"content\": [","            {","                \"type\": \"TEXT\",","                \"text\": \"\\n\\nGiven an input Question, create a syntactically correct Oracle SQL query to run. \\n - Pay attention to using only the column names that you can see in the schema description.\\n - Be careful to not query for columns that do not exist. Also, pay attention to which column is in which table.\\n - Please double check that the SQL query you generate is valid for Oracle Database.\\n - Consider table name, schema name and column name to be case sensitive and enclose in double quotes.  - Only use the tables listed below. \\n - If the table definition includes the table owner, you should include both the owner name and user-qualified table name in the Oracle SQL. - DO NOT keep empty lines in the middle of the Oracle SQL.\\n - DO NOT write anything else except the Oracle SQL.\\n - Always use table alias and easy to read column aliases. \\n\\nQuestion:how many customers do I have\"","            }","        ]","    }","]"],"enabled":false,"result":null,"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":null},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"View history of SQL invocations","message":["%sql","","SELECT SQL_TEXT, MAPPED_SQL_TEXT, TRANSLATION_TIMESTAMP","FROM V$MAPPED_SQL","ORDER BY TRANSLATION_TIMESTAMP DESC;"],"enabled":false,"result":{"startTime":1760115831555,"interpreter":"sql.medium","endTime":1760115831911,"results":[{"message":"ORA-00942: table or view \"SYS\".\"V_$MAPPED_SQL\" does not exist\n\nhttps://docs.oracle.com/error-help/db/ora-00942/","type":"TEXT"}],"taskStatus":"ERROR","forms":"[]","status":"ERROR"},"sizeX":0,"hideCode":true,"width":0,"hideResult":true,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":"[{\"bar\":{\"showSeries\":[\"customer_count\"],\"aggregationOption\":\"Last\",\"series\":{\"availableSeriesElements\":[{\"id\":\"customer_count\",\"lineType\":\"straight\",\"borderColor\":\"rgb(25, 95, 116)\",\"borderWidth\":0,\"color\":\"rgb(25, 95, 116)\",\"pattern\":\"auto\",\"markerColor\":\"rgb(25, 95, 116)\",\"markerDisplayed\":\"auto\",\"markerShape\":\"auto\",\"markerSize\":0}]},\"lastColumns\":[\"country_id\",\"customer_count\"],\"version\":1}}]","hideInIFrame":false,"selectedVisualization":"bar","title":"Run SQL query for \"how many are in each country and place in descending order\"","message":["%sql","","-- This begins a series of conversation-aware queries that build on previous requests using the conversation capability.","-- To see the tabular data, click on the \"table\" icon on the left.","","SELECT AI how many are in each country and place in descending order"],"enabled":true,"result":{"startTime":1760115945889,"interpreter":"sql.medium","endTime":1760115949960,"results":[{"message":"Country ID\tCountry Name\tCustomer Count\n52790\tUnited States of America\t18520\n52776\tGermany\t8173\n52770\tItaly\t7780\n52789\tUnited Kingdom\t7557\n52779\tFrance\t3833\n52778\tSpain\t2039\n52772\tCanada\t2010\n52775\tBrazil\t832\n52774\tAustralia\t831\n52771\tChina\t712\n52786\tPoland\t708\n52782\tJapan\t624\n52769\tSingapore\t597\n52773\tArgentina\t403\n52777\tDenmark\t383\n52785\tNew Zealand\t244\n52788\tTurkey\t91\n52791\tSouth Africa\t88\n52787\tSaudi Arabia\t75\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":"[{\"bar\":{\"showSeries\":[\"Number of Females\"],\"aggregationOption\":\"Last\",\"series\":{\"availableSeriesElements\":[{\"id\":\"Number of Females\",\"lineType\":\"straight\",\"borderColor\":\"rgb(25, 95, 116)\",\"borderWidth\":0,\"color\":\"rgb(25, 95, 116)\",\"pattern\":\"auto\",\"markerColor\":\"rgb(25, 95, 116)\",\"markerDisplayed\":\"auto\",\"markerShape\":\"auto\",\"markerSize\":0},{\"id\":\"Number of Males\",\"lineType\":\"straight\",\"borderColor\":\"rgb(25, 95, 116)\",\"borderWidth\":0,\"color\":\"rgb(25, 95, 116)\",\"pattern\":\"auto\",\"markerColor\":\"rgb(25, 95, 116)\",\"markerDisplayed\":\"auto\",\"markerShape\":\"auto\",\"markerSize\":0}]},\"lastColumns\":[\"Country Name\",\"Number of Males\",\"Number of Females\"],\"version\":1}}]","hideInIFrame":false,"selectedVisualization":"table","title":"Run SQL query for \"add to that the number of males and females in each country\"","message":["%sql","","-- This uses the conversation to further refine the result from the previous invocation.","","SELECT AI add the number of males and females in each country "],"enabled":true,"result":{"startTime":1760115956404,"interpreter":"sql.medium","endTime":1760115961768,"results":[{"message":"Country ID\tCountry Name\tMale Count\tFemale Count\n52769\tSingapore\t395\t202\n52770\tItaly\t5167\t2613\n52771\tChina\t477\t235\n52772\tCanada\t1371\t639\n52773\tArgentina\t264\t139\n52774\tAustralia\t531\t300\n52775\tBrazil\t531\t301\n52776\tGermany\t5564\t2609\n52777\tDenmark\t257\t126\n52778\tSpain\t1376\t663\n52779\tFrance\t2614\t1219\n52782\tJapan\t397\t227\n52785\tNew Zealand\t157\t87\n52786\tPoland\t476\t232\n52787\tSaudi Arabia\t52\t23\n52788\tTurkey\t61\t30\n52789\tUnited Kingdom\t5111\t2446\n52790\tUnited States of America\t12323\t6197\n52791\tSouth Africa\t51\t37\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"Find the top 3 baby boomer big spenders","message":["%sql","","-- This uses the general knowledge of the LLM to understand what a \"baby boomer\" and \"big spenders\" are.","","SELECT AI find the top 3 baby boomer big spenders"],"enabled":true,"result":{"startTime":1760115965413,"interpreter":"sql.medium","endTime":1760115970382,"results":[{"message":"First Name\tLast Name\tTotal Spend\nMarvel\tBakerman\t145358.48\nHarold\tAllis\t143700.7\nOna\tCattlett\t122683.52\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Narrate the query result for \"find the top 3 baby boomer big spenders\"","message":["%sql","","SELECT AI narrate find the top 3 baby boomer big spenders"],"enabled":true,"result":{"startTime":1760115977386,"interpreter":"sql.medium","endTime":1760115984766,"results":[{"message":"RESPONSE\nThe top 3 big spenders who were born between 1946 and 1964 are: * Marvel Bakerman * Harold Allis * Ona Cattlett  They have spent the most money among their age group.\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Show SQL for \"find the top 3 baby boomer big spenders\"","message":["%script","","-- Notice in the query: \"CUST_YEAR_OF_BIRTH BETWEEN 1946 AND 1964\"","","SELECT AI showsql find the top 3 baby boomer big spenders"],"enabled":true,"result":{"startTime":1760115985119,"interpreter":"script.medium","endTime":1760115989786,"results":[{"message":"\nRESPONSE                                              \nSELECT \n  c.\"CUST_FIRST_NAME\" AS \"First Name\", \n  c.\"CUST_LAST_NAME\" AS \"Last Name\", \n  SUM(s.\"AMOUNT_SOLD\") AS \"Total Spend\"\nFROM \n  \"SH\".\"CUSTOMERS\" c\n  JOIN \"SH\".\"SALES\" s ON c.\"CUST_ID\" = s.\"CUST_ID\"\nWHERE \n  c.\"CUST_YEAR_OF_BIRTH\" BETWEEN 1946 AND 1964\nGROUP BY \n  c.\"CUST_FIRST_NAME\", c.\"CUST_LAST_NAME\"\nORDER BY \n  \"Total Spend\" DESC\nFETCH FIRST 3 ROWS ONLY    \n\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Explain SQL for \"find the top 3 baby boomer big spenders\"","message":["%script","","SELECT AI explainsql find the top 3 baby boomer big spenders"],"enabled":true,"result":{"startTime":1760115990147,"interpreter":"script.medium","endTime":1760116002826,"results":[{"message":"\nRESPONSE                                                                                                                                                                                                                                                                                     \n```sql\nSELECT \n  c.\"CUST_FIRST_NAME\" AS \"First Name\", \n  c.\"CUST_LAST_NAME\" AS \"Last Name\", \n  SUM(s.\"AMOUNT_SOLD\") AS \"Total Spend\"\nFROM \n  \"SH\".\"CUSTOMERS\" c\n  JOIN \"SH\".\"SALES\" s ON c.\"CUST_ID\" = s.\"CUST_ID\"\nWHERE \n  c.\"CUST_YEAR_OF_BIRTH\" BETWEEN 1946 AND 1964\nGROUP BY \n  c.\"CUST_FIRST_NAME\", c.\"CUST_LAST_NAME\"\nORDER BY \n  \"Total Spend\" DESC\nFETCH FIRST 3 ROWS ONLY;\n```\n\n**Explanation:**\n\nThis Oracle SQL query finds the top 3 big spenders among the baby boomer generation (born between 1946 and 1964). \n\n1. **Table Selection:** The query joins two tables: `\"SH\".\"CUSTOMERS\"` (aliased as `c`) and `\"SH\".\"SALES\"` (aliased as `s`). The join is based on the `\"CUST_ID\"` column, which is common to both tables.\n\n2. **Filtering:** The `WHERE` clause filters the results to include only customers born between 1946 and 1964, which is the typical birth range for the baby boomer generation.\n\n3. **Grouping and Aggregation:** The `GROUP BY` clause groups the results by the customer's first and last name. The `SUM` aggregation function calculates the total amount spent by each customer.\n\n4. **Sorting and Limiting:** The `ORDER BY` clause sorts the results in descending order based on the total spend. The `FETCH FIRST 3 ROWS ONLY` clause limits the output to the top 3 big spenders.\n\n**Note:** The query uses table aliases (`c` and `s`) to improve readability and follows the rules for string comparisons in the `WHERE` clause. However, since there are no string comparisons in this query, the rules for case-sensitive and case-insensitive comparisons do not apply.    \n\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","### Use GENERATE for 'stateless' invocation","","The `DBMS_CLOUD_AI.GENERATE` procedure provides programmatic access to Select AI capabilities. ","This approach is required for stateless environments like Oracle APEX applications or scheduled PL/SQL procedures. ","The function returns results as a VARCHAR2, which is why the examples use DBMS_OUTPUT.PUT_LINE to display the returned string. ","","The examples demonstrate using GENERATE with different actions: 'showsql' to get SQL statements, 'runsql' to run queries, ","'explainsql' to obtain query explanations, and 'narrate' to provide a natural language interpretation of the query result.","","You can also use the conversation API with GENERATE to enable conversations with Oracl APEX. "],"enabled":true,"result":{"startTime":1760116008773,"interpreter":"md.medium","endTime":1760116009095,"results":[{"message":"<h3 id=\"use-generate-for-stateless-invocation\">Use GENERATE for 'stateless' invocation<\/h3>\n<p>The <code>DBMS_CLOUD_AI.GENERATE<\/code> procedure provides programmatic access to Select AI capabilities.\nThis approach is required for stateless environments like Oracle APEX applications or scheduled PL/SQL procedures.\nThe function returns results as a VARCHAR2, which is why the examples use DBMS_OUTPUT.PUT_LINE to display the returned string.<\/p>\n<p>The examples demonstrate using GENERATE with different actions: 'showsql' to get SQL statements, 'runsql' to run queries,\n'explainsql' to obtain query explanations, and 'narrate' to provide a natural language interpretation of the query result.<\/p>\n<p>You can also use the conversation API with GENERATE to enable conversations with Oracl APEX.<\/p>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":0,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Use GENERATE with 'showsql'","message":["%script\r","\r","DECLARE\r","  v_response VARCHAR2(4000); \r","BEGIN\r","  v_response := DBMS_CLOUD_AI.GENERATE('find the top 3 baby boomer big spenders','OCI_GENAI','showsql');\r","  DBMS_OUTPUT.PUT_LINE(v_response);\r","END;"],"enabled":true,"result":{"startTime":1760116004085,"interpreter":"script.medium","endTime":1760116009849,"results":[{"message":"SELECT \n  c.\"CUST_FIRST_NAME\" AS \"First Name\", \n  c.\"CUST_LAST_NAME\" AS \"Last Name\", \n  SUM(s.\"AMOUNT_SOLD\") AS \"Total Spend\"\nFROM \n  \"SH\".\"CUSTOMERS\" c\n  JOIN \"SH\".\"SALES\" s ON c.\"CUST_ID\" = s.\"CUST_ID\"\nWHERE \n  c.\"CUST_YEAR_OF_BIRTH\" BETWEEN 1946 AND 1964\nGROUP BY \n  c.\"CUST_FIRST_NAME\", c.\"CUST_LAST_NAME\"\nORDER BY \n  \"Total Spend\" DESC\nFETCH FIRST 3 ROWS ONLY\n\n\nPL/SQL procedure successfully completed.\n\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":"[{\"raw\":{\"height\":300,\"lastColumns\":[],\"version\":1}}]","hideInIFrame":false,"selectedVisualization":"raw","title":"Use GENERATE  'runsql' for the same prompt","message":["%script\r","\r","DECLARE\r","  v_response VARCHAR2(4000); \r","BEGIN\r","  v_response := DBMS_CLOUD_AI.GENERATE('find the top 3 baby boomer big spenders','OCI_GENAI','runsql');\r","  DBMS_OUTPUT.PUT_LINE(v_response);\r","END;"],"enabled":true,"result":{"startTime":1760116010205,"interpreter":"script.medium","endTime":1760116015366,"results":[{"message":"[\n  {\n    \"First Name\" : \"Marvel\",\n    \"Last Name\" : \"Bakerman\",\n    \"Total Spend\" : 145358.48\n  },\n  {\n    \"First Name\" : \"Harold\",\n    \"Last Name\" : \"Allis\",\n    \"Total Spend\" : 143700.7\n  },\n  {\n    \"First Name\" : \"Ona\",\n    \"Last Name\" : \"Cattlett\",\n    \"Total Spend\" : 122683.52\n  }\n]\n\n\nPL/SQL procedure successfully completed.\n\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Use GENERATE with 'explainsql'","message":["%script","","DECLARE","  v_response VARCHAR2(4000);  ","BEGIN","  v_response := DBMS_CLOUD_AI.GENERATE('find the top 3 baby boomer big spenders','OCI_GENAI','explainsql');","  DBMS_OUTPUT.PUT_LINE(v_response);  ","END;"],"enabled":true,"result":{"startTime":1760116015731,"interpreter":"script.medium","endTime":1760116033511,"results":[{"message":"```sql\nSELECT \n  c.\"First Name\" AS \"First Name\", \n  c.\"Last Name\" AS \"Last Name\", \n  SUM(s.\"Amount Sold\") AS \"Total Spend\"\nFROM \n  \"SH\".\"CUSTOMERS\" c\n  JOIN \"SH\".\"SALES\" s ON c.\"CUST_ID\" = s.\"CUST_ID\"\nWHERE \n  c.\"Year of Birth\" BETWEEN 1946 AND 1964\nGROUP BY \n  c.\"First Name\", c.\"Last Name\"\nORDER BY \n  \"Total Spend\" DESC\nFETCH FIRST 3 ROWS ONLY;\n```\n\nHowever, the above query does not match the schema provided. Based on the schema provided, the correct query should be:\n\n```sql\nSELECT \n  cu.\"CUST_FIRST_NAME\" AS \"First Name\", \n  cu.\"CUST_LAST_NAME\" AS \"Last Name\", \n  SUM(sa.\"AMOUNT_SOLD\") AS \"Total Spend\"\nFROM \n  \"SH\".\"CUSTOMERS\" cu\n  JOIN \"SH\".\"SALES\" sa ON cu.\"CUST_ID\" = sa.\"CUST_ID\"\nWHERE \n  cu.\"CUST_YEAR_OF_BIRTH\" BETWEEN 1946 AND 1964\nGROUP BY \n  cu.\"CUST_FIRST_NAME\", cu.\"CUST_LAST_NAME\"\nORDER BY \n  \"Total Spend\" DESC\nFETCH FIRST 3 ROWS ONLY;\n```\n\n**Explanation:**\n\nThis Oracle SQL query finds the top 3 big spenders among the baby boomer generation (born between 1946 and 1964). \n\n1. **Table Selection:** The query joins two tables: `\"SH\".\"CUSTOMERS\"` (aliased as `cu`) and `\"SH\".\"SALES\"` (aliased as `sa`). The join is based on the `\"CUST_ID\"` column, which is common to both tables.\n\n2. **Filtering:** The `WHERE` clause filters the results to include only customers born between 1946 and 1964, which is the typical birth range for the baby boomer generation.\n\n3. **Grouping and Aggregation:** The `GROUP BY` clause groups the results by the customer's first and last name. The `SUM` aggregation function calculates the total amount spent by each customer.\n\n4. **Sorting and Limiting:** The `ORDER BY` clause sorts the results in descending order based on the total spend. The `FETCH FIRST 3 ROWS ONLY` clause limits the output to the top 3 big spenders.\n\n**Note:** The query uses table aliases (`cu` and `sa`) to improve readability and follows the rules for case-sensitive and case-insensitive comparisons in the `WHERE` clause. However, since there are no string comparisons in this query, the rules for case-sensitive and case-insensitive comparisons do not apply.\n\n\nPL/SQL procedure successfully completed.\n\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Use GENERATE with 'narrate'","message":["%script","","DECLARE","  v_response VARCHAR2(4000);  ","BEGIN","  v_response := DBMS_CLOUD_AI.GENERATE('find the top 3 baby boomer big spenders','OCI_GENAI','narrate');","  DBMS_OUTPUT.PUT_LINE(v_response);  ","END;"," "],"enabled":true,"result":{"startTime":1760116034068,"interpreter":"script.medium","endTime":1760116041534,"results":[{"message":"The top 3 big spenders among the baby boomer generation are:\n* Marvel Bakerman\n* Harold Allis\n* Ona Cattlett \nThey have spent the most money among their age group.\n\n\nPL/SQL procedure successfully completed.\n\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":0,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","### Use GENERATE with the Conversation Management API","","The Conversation Management API enables greater control over conversations. You can create named conversations and manage their content. While the existing session-based conversation ","feature remains available, this API enhances functionality by enabling conversations to persist beyond the end of a database session, associating user-specified names ","and descriptions with conversations, supporting compatibility across different profiles and actions, and allowing the storage of virtually unlimited prompts. This transforms ","conversations into persistent database objects you can maintain over time."],"enabled":true,"result":{"startTime":1760116056302,"interpreter":"md.medium","endTime":1760116056637,"results":[{"message":"<h3 id=\"use-generate-with-the-conversation-management-api\">Use GENERATE with the Conversation Management API<\/h3>\n<p>The Conversation Management API enables greater control over conversations. You can create named conversations and manage their content. While the existing session-based conversation\nfeature remains available, this API enhances functionality by enabling conversations to persist beyond the end of a database session, associating user-specified names\nand descriptions with conversations, supporting compatibility across different profiles and actions, and allowing the storage of virtually unlimited prompts. This transforms\nconversations into persistent database objects you can maintain over time.<\/p>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":0,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Create a new conversation with GENERATE","message":["%script","","-- select DBMS_CLOUD_AI.create_conversation;","","CREATE OR REPLACE PACKAGE my_globals IS","  conversation_id varchar2(4000);","END my_globals;","/","-- Create conversation","DECLARE","  conversation_id varchar2(4000);","BEGIN","  conversation_id := DBMS_CLOUD_AI.create_conversation();","  my_globals.conversation_id := conversation_id;","  DBMS_OUTPUT.PUT_LINE('Created conversation with ID: ' || my_globals.conversation_id);","END;"],"enabled":true,"result":{"startTime":1760116815706,"interpreter":"script.medium","endTime":1760116816129,"results":[{"message":"\nPackage MY_GLOBALS compiled\n\n\n---------------------------\nCreated conversation with ID: 40D1E4B2-8E1B-10C4-E063-1A5B000A677D\n\n\nPL/SQL procedure successfully completed.\n\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":0,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Run first query in conversation with GENERATE","message":["%script","","DECLARE","  v_response VARCHAR2(4000);","BEGIN","  v_response :=  DBMS_CLOUD_AI.generate(","        prompt       =>  'How many customers do I have',","        profile_name =>  'OCI_GENAI',","        action       =>  'RUNSQL',","        params       =>  '{\"conversation_id\":\"' || my_globals.conversation_id || '\"}'","  );","  DBMS_OUTPUT.PUT_LINE(v_response);","END;"],"enabled":true,"result":{"startTime":1760117468021,"interpreter":"script.medium","endTime":1760117484533,"results":[{"message":"[\n  {\n    \"Total Customers\" : 55500\n  }\n]\n\n\nPL/SQL procedure successfully completed.\n\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":0,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":"[{\"raw\":{\"height\":400,\"lastColumns\":[],\"version\":1}}]","hideInIFrame":false,"selectedVisualization":"raw","title":"Run follow-up query in conversation with GENERATE","message":["%script","","DECLARE","  v_response VARCHAR2(4000);","BEGIN","  v_response :=  DBMS_CLOUD_AI.generate(","        prompt       =>  'how many are in each country and place in descending order',","        profile_name =>  'OCI_GENAI',","        action       =>  'RUNSQL',","        params       =>  '{\"conversation_id\":\"' || my_globals.conversation_id || '\"}'","  );","  DBMS_OUTPUT.PUT_LINE(v_response);","END;"],"enabled":true,"result":{"startTime":1760117540455,"interpreter":"script.medium","endTime":1760117545417,"results":[{"message":"[\n  {\n    \"Country ID\" : 52773,\n    \"Country Name\" : \"Argentina\",\n    \"Number of Customers\" : 403\n  },\n  {\n    \"Country ID\" : 52786,\n    \"Country Name\" : \"Poland\",\n    \"Number of Customers\" : 708\n  },\n  {\n    \"Country ID\" : 52772,\n    \"Country Name\" : \"Canada\",\n    \"Number of Customers\" : 2010\n  },\n  {\n    \"Country ID\" : 52777,\n    \"Country Name\" : \"Denmark\",\n    \"Number of Customers\" : 383\n  },\n  {\n    \"Country ID\" : 52785,\n    \"Country Name\" : \"New Zealand\",\n    \"Number of Customers\" : 244\n  },\n  {\n    \"Country ID\" : 52770,\n    \"Country Name\" : \"Italy\",\n    \"Number of Customers\" : 7780\n  },\n  {\n    \"Country ID\" : 52778,\n    \"Country Name\" : \"Spain\",\n    \"Number of Customers\" : 2039\n  },\n  {\n    \"Country ID\" : 52779,\n    \"Country Name\" : \"France\",\n    \"Number of Customers\" : 3833\n  },\n  {\n    \"Country ID\" : 52769,\n    \"Country Name\" : \"Singapore\",\n    \"Number of Customers\" : 597\n  },\n  {\n    \"Country ID\" : 52790,\n    \"Country Name\" : \"United States of America\",\n    \"Number of Customers\" : 18520\n  },\n  {\n    \"Country ID\" : 52782,\n    \"Country Name\" : \"Japan\",\n    \"Number of Customers\" : 624\n  },\n  {\n    \"Country ID\" : 52771,\n    \"Country Name\" : \"China\",\n    \"Number of Customers\" : 712\n  },\n  {\n    \"Country ID\" : 52788,\n    \"Country Name\" : \"Turkey\",\n    \"Number of Customers\" : 91\n  },\n  {\n    \"Country ID\" : 52776,\n    \"Country Name\" : \"Germany\",\n    \"Number of Customers\" : 8173\n  },\n  {\n    \"Country ID\" : 52791,\n    \"Country Name\" : \"South Africa\",\n    \"Number of Customers\" : 88\n  },\n  {\n    \"Country ID\" : 52774,\n    \"Country Name\" : \"Australia\",\n    \"Number of Customers\" : 831\n  },\n  {\n    \"Country ID\" : 52787,\n    \"Country Name\" : \"Saudi Arabia\",\n    \"Number of Customers\" : 75\n  },\n  {\n    \"Country ID\" : 52789,\n    \"Country Name\" : \"United Kingdom\",\n    \"Number of Customers\" : 7557\n  },\n  {\n    \"Country ID\" : 52775,\n    \"Country Name\" : \"Brazil\",\n    \"Number of Customers\" : 832\n  }\n]\n\n\nPL/SQL procedure successfully completed.\n\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":0,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"View conversation prompts history","message":["%sql","","SELECT * ","FROM   user_cloud_ai_conversation_prompts","ORDER BY CREATED desc","FETCH FIRST 2 ROWS ONLY;"],"enabled":true,"result":{"startTime":1760118307639,"interpreter":"sql.medium","endTime":1760118308007,"results":[{"message":"CONVERSATION_PROMPT_ID\tCONVERSATION_ID\tCONVERSATION_TITLE\tPROFILE_NAME\tPROMPT_ACTION\tPROMPT\tPROMPT_RESPONSE\tCREATED\tMODIFIED\tCLIENT_IDENTIFIER\tCLIENT_IP\tSID\tSERIAL#\n40D1E4B2-8E20-10C4-E063-1A5B000A677D\t40D1E4B2-8E1B-10C4-E063-1A5B000A677D\tCustomer Count\tOCI_GENAI\tRUNSQL\thow many are in each country and place in descending order\tSELECT    c.\"COUNTRY_ID\" AS \"Country ID\",    co.\"COUNTRY_NAME\" AS \"Country Name\",    COUNT(c.\"CUST_ID\") AS \"Number of Customers\" FROM    \"SH\".\"CUSTOMERS\" c   JOIN \"SH\".\"COUNTRIES\" co ON c.\"COUNTRY_ID\" = co.\"COUNTRY_ID\" GROUP BY    c.\"COUNTRY_ID\", co.\"COUNTRY_NAME\" ORDER BY    COUNT(c.\"CUST_ID\") DESC\t2025-10-10 17:32:25.321046 UTC\t2025-10-10 17:32:25.321053 UTC\t\t131.186.8.36\t40134\t55032\n40D1E4B2-8E1E-10C4-E063-1A5B000A677D\t40D1E4B2-8E1B-10C4-E063-1A5B000A677D\tCustomer Count\tOCI_GENAI\tRUNSQL\tHow many customers do I have\tSELECT COUNT(c.\"CUST_ID\") AS \"Total Customers\"  FROM \"SH\".\"CUSTOMERS\" c\t2025-10-10 17:31:24.476609 UTC\t2025-10-10 17:31:24.476613 UTC\t\t131.186.8.36\t40134\t55032\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":0,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md\r","\r","# End of Script"],"enabled":true,"result":{"startTime":1760116119993,"interpreter":"md.medium","endTime":1760116120326,"results":[{"message":"<h1 id=\"end-of-script\">End of Script<\/h1>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"}],"version":"7","snapshot":false,"tags":null}]